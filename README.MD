# Синхронний Node.JS REST-сервіс з підтримкою системи «Трембіта»

REST-сервіс, описаний в даній інструкції, розроблений на мові програмування JavaScript з використанням Node.js та фреймворку EXPRESS і є сумісним з системою «Трембіта».

EXPRESS - швидкий, мінімалістичний веб-фреймворк для Node.js для побудови API.

Даний сервіс передбачає отримання з бази даних (реєстру) відомостей про інформаційні об'єкти (користувачів) та управління їх статусом, у тому числі обробку запитів на пошук, отримання, створення, редагування та видалення об'єктів.

Для демонстрації інтеграції з системою «Трембіта» було розроблено [вебклієнт](https://github.com/MadCat-88/Trembita_JS_R_SyncCli) для роботи з даним вебсервісом.

## Вимоги до програмного забезпечення

| ПЗ            |   Версія   | Примітка                                                                                                                                                                                               |
|:--------------|:----------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ubuntu Server |   24.04    | Рекомендовані характеристики віртуальної машини:<br/> CPU: 1 <br/> RAM: 512 Мб                                                                                                                         |
| Node js         | **20.14.0++**  | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції.<br/>**Важливо!** Якщо версія Node js нижче 20.14.0, сервіс працювати не буде. |
| MariaDB       |  10.5+    | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції                                                                            |
| Git           |            | Для клонування репозиторію |

## Структура проєкту

Проєкт складається з наступних файлів та директорій:

```bash
rest-sync-service-node-express-js/
|-- config                                  # Директорія з конфігурацією застосунку
|   |-- config.js                           # Конфігурація бд
|-- controllers                             # Директорія з контролерами
|   |-- personController.js                 # Контролер для роботи з особами
|   |-- statusController.js                 # Контролер для роботи зі статусом
|-- logs                                    # Директорія для зберігання логів
|   |-- combined.log                        # Логи для об'єднаних повідомлень
|   |-- error.log                           # Логи для повідомлень про помилки
|-- middleware                              # Директорія з проміжними обробниками 
|   |-- contentTypeValidation.js            # Валідація типів вмісту
|   |-- logger.js                           # Логування
|   |-- personValidation.js                 # Валідація параметрів
|   |-- requestLogger.js                    # Логування запитів
|   |-- responseLogger.js                   # Логування відповідей
|-- migrations                              # Директорія з міграціями бази даних
|   |-- 20240518104703-add_Persons_table.js # Конфігурація міграцій БД для додавання таблиці осіб
|-- models                                  # Директорія з моделями даних
|   |-- index.js                            # Підключення моделей 
|   |-- Person.js                           # Модель особи
|-- node_modules *                          # Директорія з залежностями Node.js
|-- routes                                  # Директорія з маршрутами 
|   |-- person.js                           # Маршрути для роботи з особами
|   |-- status.js                           # Маршрути для роботи зі статусами
|-- services                                # Директорія з сервісами
|   |-- personService.js                    # Сервіс для обробки логіки роботи з особами
|   |-- statusService.js                    # Сервіс для обробки логіки роботи зі статусом
|-- .env                                    # Конфігурація середовища
|-- .gitignore                              # Ігнорування файлів Git
|-- .sequelizerc                            # Конфігурація Sequelize
|-- app.js                                  # Основний файл застосунку
|-- deploy.sh                               # Скрипт для автоматизації встановлення
|-- index.js                                # Точка входу застосунку
|-- package.json                            # Залежності проєкту
|-- package-lock.json                       # Файл блокування залежностей
|-- README.MD                               # Документація проєкту
|-- swagger-output.json                     # Вихідний файл Swagger документації
|-- swagger.js                              # Конфігурація Swagger документації
```

## Інсталяція сервісу

Сервіс можна інсталювати за допомогою скрипта автоматичного встановлення або вручну. Також сервіс може працювати в Docker.
- [Інсталяція сервісу за допомогою скрипта автоматичного встановлення](./docs/script_installation.md).
- [Інсталяція сервісу вручну](./docs/manual_installation.md).
- [Конфігурація сервісу](./docs/configuration.md).
- [Розгортання вебсервісу в Docker ](./docs/docker_installation.md).

## Наповнення бази даних тестовими записами

Для забезпечення зручності тестування розробленого вебсервісу потрібно наповнити його БД тестовими записами.
З цією метою було розроблено окремий скрипт, інсталяція та робота з яким описані [тут](https://github.com/MadCat-88/Trembita_PutFakeData_Rest)

**Примітка:** При використанні даного скрипта в його налатуваннях необхідно змінити порт на якому працює вебсервіс.

## Адміністрування сервісу

### Запуск вебсервісу

Для запуска вебсервісу необхідно виконати наступну команду:

```bash
sudo systemctl start rest-sync-service-node-express-js
```

### Ознайомлення з документацією АРІ

Після запуску вебсервісу можна отримати доступ до автоматичної **документації API** за наступною адресою:

- Swagger UI: http://[адреса серверу]:3000/api-docs

### Перевірка статусу вебсервісу

```bash
sudo systemctl status rest-sync-service-node-express-js
```

### Зупинка вебсервісу

```bash
sudo systemctl stop rest-sync-service-node-express-js
```

### Видалення вебсервісу

Для видалення вебсервісу та всіх пов'язаних компонентів було створено скрипт `remove.sh`.
Даний скрипт після запуску, зупинить та видалить вебсервіс, видалить віртуальне середовище, клонований репозиторій та системні залежності.

Для того, щоб запустити скрипт необхідно:

1. Зробити файл виконуваним:

```bash
chmod +x remove.sh
```

2. Запустити скрипт:

```bash
./remove.sh
```

Також існує можливість видалення вебсервісу вручну, згідно відповідної [інструкції](/docs/delete.md)

### Перегляд журналу подій

За замовчуванням журнал подій зберігаються у двох файлах `error.log`та `combined.log`. 

Конфігурація параметрів журналювання подій виконується в файлі «.env». Детальніше з параметрами журналювання в даних файлах можна ознайомитися в [настановах з конфігурації](/docs/configuration.md).

Для того, щоб переглянути журнал подій вебсервісу необхідно виконати команду:

```bash
journalctl -u rest-sync-service-node-express-js -f
```

### Налаштування HTTPS

Налаштування підключення до сервісу за протоколом HTTPS наведено [в інструкції](./docs/https_nginx_reverse_proxy.md).

## Інтеграція вебсервісу з системою «Трембіта»

Системи «Трембіта» не вимагає особливої спеціалізації вебсервісів для роботи з нею. Для повноцінної інтеграції з системою «Трембіта» вебсервіс повинен підтримувати можливість зберігання заголовків системи «Трембіта», які було передані в запиті від вебкліента через ШБО.

Більш детальну інформацію про заголовки наведено в описі [роботи із REST-сервісами в системі «Трембіта»](https://github.com/MadCat-88/Services-development-for-Trembita-system/blob/main/REST%20services%20development%20for%20Trembita%20system.md#%D0%B7%D0%B0%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BA%D0%B8-%D0%B7%D0%B0%D0%BF%D0%B8%D1%82%D1%96%D0%B2-%D0%B4%D0%BB%D1%8F-rest-%D1%81%D0%B5%D1%80%D0%B2%D1%96%D1%81%D1%96%D0%B2-%D0%BD%D0%B5%D0%BE%D0%B1%D1%85%D1%96%D0%B4%D0%BD%D1%96-%D0%B7%D0%B0%D0%B4%D0%BB%D1%8F-%D0%B7%D0%B0%D0%B1%D0%B5%D0%B7%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%BD%D1%8F-%D1%81%D1%83%D0%BC%D1%96%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%96-%D0%B7-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BE%D1%8E-%D1%82%D1%80%D0%B5%D0%BC%D0%B1%D1%96%D1%82%D0%B0).

## Використання сервісу

Вебсервіс представляє собою набір з 4 методів, які дозволяють управляти записами про умовних користувачів (Person) в БД:

- [створення нового запису](./docs/using.md#person-post);
- [оновлення існуючого запису за кодом УНЗР](./docs/using.md#person-update);
- [отримання запису по заданому критерію пошуку](./docs/using.md#person-get-by-parameter);
- [видалення існуючого запису за кодом УНЗР](././docs/using.md#person-delete).

Також існує окремий метод, за допомогою якого можна [перевірити статус вебсервісу](./docs/using.md#Check-Service-Status);.

Після встановлення вебсервісу його база даних порожня.
Для демонстрації можливостей вебсервісу першим кроком необхідно створити нові записи в БД. Це можна зробити використовуючи відповідний [вебклієнт](https://github.com/MadCat-88/Trembita_Py_R_SyncCli), з використанням методу [Person Post](./docs/using.md#person-post) або за допомогою [скрипта наповнення бази даних](./README.MD#наповнення-бази-даних-тестовими-записами).

## Внесок

Якщо ви хочете зробити свій внесок у проєкт, будь ласка, створіть форк репозиторію і відправте Pull Request.

## Ліцензія

Цей проєкт ліцензується відповідно до умов MIT License.

 ##
Матеріали створено за підтримки проєкту міжнародної технічної допомоги «Підтримка ЄС цифрової трансформації України (DT4UA)».
