# Використання сервісу

### **Person Post**
Створюється один запис в БД про певну особу.

|  Метод HTTP | Код сервісу  | Базова URL                        |
|:-------:|:-------------:|-----------------------------------|
|  POST   |  Person Post     | http://your-server-ip:3000/person |


Параметри запиту виглядають наступним чином:

```
{
      "name": "Марина",
      "surname": "Петренко",
      "patronym": "Петрівна",
      "dateOfBirth": "2024-10-11",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
      "gender": "female",
}
```

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних                         | Значення параметру                                                                                                                        | Обов’язковість |
|:------------------------:|----------------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|:--------------:|
|            1             | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |      	Так      |
|            1             | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      	Так      |
|            1             | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      	Ні       |
|            1             | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      	Так      |
|            1             | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      	Так      |
|            1             | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      	Так      |
|            1             | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |      Так       |
|            1             | 	gender              | 	String                           | 	Стать                                                                                                                                    |      	Так      |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'POST' \
  'http://your-server-ip:3000/person' \
  -H 'accept: */*' \
  -H 'Content-Type: application/json' \
  -d "{\"name\": \"Марина\", \"surname\": \"Петренко\", \"patronym\": \"Петрівна\", \"dateOfBirth\": \"2024-10-11\", \"rnokpp\": \"1111111111\", \"passportNumber\": \"123456789\", \"unzr\": \"20241011-12345\", \"gender\": \"female\"}"
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=201** - Created) виглядатиме наступним чином:

```
  {
    "id": 14,
    "name": "Тарас",
    "surname": "Шевченко",
    "patronym": "Григорович",
    "dateOfBirth": "1814-03-09",
    "rnokpp": "8548963250",
    "unzr": "18140309-12345",
    "passportNumber": "877854159",
    "gender": "male",
    "updatedAt": "2025-03-26T16:16:10.878Z",
    "createdAt": "2025-03-26T16:16:10.878Z"
}
```

де:

| Рівень <br/> вкладеності | Тип даних | Значення параметру        | Обов’язковість |
|:------------------------:|-----------|---------------------------|:--------------:|
|            1             |  	Array  | 	Масив даних              |      Так       |



**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=409** - Conflict) виглядатиме наступним чином:

```
{
"Помилка унікальності. rnokpp must be unique"
}
```
де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру        | Обов’язковість |
|:------------------------:|-----------|---------------------------|:--------------:|
|            1             | 	String    | 	Опис помилки              |      	Так      |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422** - Unprocessable entity) виглядатиме наступним чином:

```
{
"Помилки валідації: Field: rnokpp, Value: 85489632, Message: RNOKPP must be 10 digits. Format: xxxxxxxxxx"
}
```
де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру        | Обов’язковість |
|:------------------------:|-----------|----------------------------|:--------------:|
|            1             |  String   | 	Опис помилки              |      	Так      |

### **Person Get By Parameter**

Повертає записи з БД відповідно до заданих параметрів.

| Метод HTTP |       Код сервісу       | Базова URL                        |
|:----------:|:-----------------------:|-----------------------------------|
|    GET     | Person Get By Parameter | http://your-server-ip:3000/person |

**Параметри запиту**, що передаються в URL виглядають наступним чином:
```
	"param":"?",
	"value":"?"
```

де:

| **Назва параметру** | **Тип даних** | **Значення параметру**                                                                                                                                                                                                                       | **Обов’язковість**  |
|:-------------------:|:-------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------:|
|        param        |    	String    | Вказується конкретний параметр, що стосується певного запису в БД, наприклад, ім’я, УНЗР тощо. <br/> Назва параметру має бути однією з наступних:  name, surname, patronym, dateOfBirth, gender, rnokpp, passportNumber, unzr, _page, _limit |        	Так        |                                                                                                                                                 |
|        value        |    String     | 	Значення вказаного параметру                                                                                                                                                                                                               |        	Так        |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:
```
curl -X 'GET' \
  'http://http://your-server-ip:3000/person/?name=Марина' \
  -H 'accept: */*'
  ```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
    "totalCount": 1,
    "persons": [
        {
            "id": 11,
            "name": "Марина",
            "surname": "Петренко",
            "patronym": "Петрівна",
            "dateOfBirth": "2024-10-11",
            "rnokpp": "1111111111",
            "unzr": "20241011-12345",
            "passportNumber": "123456789",
            "gender": "female",
            "createdAt": "2025-03-26T16:03:24.000Z",
            "updatedAt": "2025-03-26T16:03:24.000Z"
        }
    ]
}
```

де:

|  Рівень <br/> вкладеності  | Назва <br/>параметру | Тип даних                          | Значення параметру                                                                                                                        | Обов’язковість  |
|:--------------------------:|----------------------|------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|:---------------:|
|             1              | 	totalCount          | 	Integer                          | 	Кількість знайдених користувачів                                                                                                         |      	Так      |
|             1              | 	persons             | 	Array                            | 	Масив даних                                                                                                                              |      	Так      |
|             2              | 	id	                | Integer                            | 	Ідентифікатор користувача                                                                                                                |      	Так      |
|             2              | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                     |      	Так      |
|             2              | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                 |      	Так      |
|             2              | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                              |      	Ні       |
|             2              | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                          |      	Так      |
|             2              | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                          |      	Так      |
|             2              | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                      |        Так      |
|             2              | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр |      	Так      |
|             2              | 	gender              | 	String                           | 	Стать                                                                                                                                    |      	Так      |



**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=404** - Not Found) виглядатиме наступним чином:

```
{
"Помилка пошуку. Не знайдено жодної особи"
}
```

де:

| Рівень <br/> вкладеності | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|-----------|--------------------|:--------------:|
|            1             | 	String   | 	Опис помилки      |      	Так      |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422 - Unprocessable entity**) виглядатиме наступним чином:

```
{
"Помилки валідації: Field: rnokpp, Value: 1234, Message: RNOKPP must be 10 digits. Format: xxxxxxxxxx"
}
```

де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|------------|--------------------|:--------------:|
|            1             | 	 	String  | 	Опис помилки     |      	Так     |

### **Person Update**
Вносить зміни для певного запису з БД про певну особу.

| Метод HTTP |  Код сервісу  | Базова URL                        |
|:----------:|:-------------:|-----------------------------------|
|    PUT     | Person Update | http://your-server-ip:3000/person |

Параметри запиту виглядають наступним чином:

```
{
     "attribute": "id",
     "value": "11",
      "name": "Мари",
      "surname": "Петренко",
      "patronym": "Петрівна",
      "dateOfBirth": "2024-10-11",
      "rnokpp": "1111111111",
      "passportNumber": "123456789",
      "unzr": "20241011-12345"
      "gender": "female",
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних                          | Значення параметру                                                                                                                        | Обов’язковість |
|:------------------------:|----------------------|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------:|
|            1             | 	attribute           | 	String                           | 	Вказується назва параметру, що стосується певного запису в БД, наприклад, ім’я, УНЗР тощо. <br/> Назва параметру має бути однією з наступних:  name, surname, patronym, dateOfBirth, rnokpp, unzr, passportNumber, gender, id. |      	Так    |                                                                                                                                    |      	Так      |
|            1             | 	value               | 	String                           | 	Значення вказаного параметру                                                                                                                                                                                                   |      	Так    |
|            1             | 	name                | 	String, <br/>min=1, <br/>max=128 | 	Ім’я                                                                                                                                                                                                                           |      	Ні     |
|            1             | 	surname             | 	String, <br/>min=1, <br/>max=128 | 	Прізвище                                                                                                                                                                                                                       |      	Ні     |
|            1             | 	patronym            | 	String, <br/>min=0,<br/> max=128 | 	По батькові                                                                                                                                                                                                                    |      	Ні     |
|            1             | 	dateOfBirth         | 	String                           | 	Дата народження                                                                                                                                                                                                                |      	Ні     |
|            1             | 	rnokpp              | 	String                           | 	РНОКПП, 10 цифр                                                                                                                                                                                                                |      	Ні     |
|            1             | 	unzr                | 	String                           | 	УНЗР, 14 символів в форматі YYYYMMDD-XXXXC, де  YYYY – рік, MM – місяць, DD – день,  XXXXC – 5 цифр                                                                                                                            |        Ні     |
|            1             | 	passportNumber      | 	String                           | 	Номер паспорта.<br/> **Для старого формату** – перші 2 символи - літери від А до Я, пробіл, 6 цифр.<br/> **Для нового формату** – 9 цифр                                                                                       |      	Ні     |
|            1             | 	gender              | 	String                           | 	Стать                                                                                                                                                                                                                          |      	Ні     |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'PUT' \
  'http://your-server-ip:3000/person' \
  -H 'accept: */*' \
  -H 'Content-Type: application/json' \
  -d "{\"attribute\": \"id\", \"value\": \"11\", \"unzr\": \"20241011-12354\"}"
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
"Успішно оновлено осіб - 1 за критерієм id: 11."
}
```

де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру                   | Обов’язковість |
|:------------------------:|------------|--------------------------------------|:--------------:|
|            1             | 	 String   |  Повідомлення про опрацювання запиту |      Так       |

**Тіло відповіді** у разі відсутності користувача з заданим параметром (**HTTP Code=404**) виглядатиме наступним чином:

```
{
"Помилка оновлення. Жодної особи за критерієм id: 12 не знайдено"
}
```

де:

| Рівень <br/> вкладеності | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|-----------|--------------------|:--------------:|
|            1             | 		String   | 	Опис помилки      |      	Так      |


**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422 - Unprocessable entity**) виглядатиме наступним чином:

```
{
 "Помилки валідації: Field: attribute, Value: any, Message: attribute must be either name, surname, patronym, dateOfBirth, rnokpp, unzr, passportNumber, gender or id"
}
```

де:

| Рівень <br/> вкладеності | Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|-----------|--------------------|:--------------:|
|            1             | 		String   | 	Опис помилки      |      	Так      |


### **Person Delete**
Дозволяє видалити запис з БД відповідно до заданих параметрів.

| Метод HTTP |       Код сервісу       | Базова URL                        |
|:----------:|:-----------------------:|-----------------------------------|
|    DELETE     | Person Delete | http://your-server-ip:3000/person |

**Параметри запиту**, що передаються в URL виглядають наступним чином:

```
     "attribute": "?",
     "value": "?",
```

де:

| **Назва параметру** | **Тип даних** |      **Значення параметру**      | **Обов’язковість** |
|:-------------------:|:-------------:|:--------------------------------:|:------------------:|
|        attribute        |    	String    |  Вказується назва параметру, що стосується певного запису в БД, наприклад, ім’я, УНЗР тощо. <br/> Назва параметру має бути однією з наступних:  name, surname, patronym, dateOfBirth, rnokpp, unzr, passportNumber, gender, id  |        Так         |
|        value        |    String     | Значення вказаного параметру	 |        	Так        |

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:
```
curl -X 'DELETE' \
  'http://your-server-ip:3000/person/?attribute=id&value=12' \
  -H 'accept: */*'
```

**Тіло відповіді** у разі успішного опрацювання запиту (**HTTP Code=200**) виглядатиме наступним чином:

```
{
"Успішно видалено осіб - 1 за критерієм unzr: 18140309-12345."
}
```
де:

| Рівень <br/> вкладеності | Тип даних | Значення параметру                   | Обов’язковість |
|:------------------------:|-----------|--------------------------------------|:--------------:|
|            1             | 	String   | 	Повідомлення про опрацювання запиту |      Так       |

**Тіло відповіді** у разі відсутності запису в БД із заданим УНЗР (**HTTP Code=404**) виглядатиме наступним чином:

```
{
"Помилка видалення. Жодної особи за критерієм id: 12 не знайдено"
}
```
де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|-----------|--------------------|:--------------:|
|            1             | 	 	String   | 	Опис помилки      |      	Так      |

**Тіло відповіді** у разі не успішного опрацювання запиту (**HTTP Code=422** - Unprocessable entity) виглядатиме наступним чином:
```
{
"Помилки валідації: Field: attribute, Value: any, Message: attribute must be either name, surname, patronym, dateOfBirth, rnokpp, unzr, passportNumber, gender or id"
}
```

де:

| Рівень <br/> вкладеності |  Тип даних | Значення параметру | Обов’язковість |
|:------------------------:|-----------|--------------------|:--------------:|
|            1             | 	 	String   | 	Опис помилки      |      	Так      |


### **Check Service Status**
Дозволяє перевырити працездатнысть сервісу.

| Метод HTTP |       Код сервісу       | Базова URL                        |
|:----------:|:-----------------------:|-----------------------------------|
|    GET      | Check Status | http://your-server-ip:3000/status |

Параметри запиту выдсутні.

**Приклад запиту** за допомогою утиліти **curl** виглядає наступним чином:

```
curl -X 'GET' \
  'http://your-server-ip:3000/status/' \
  -H 'accept: */*'
```

**Тіло відповіді** у разі успішної перевірки працездатності сервісу (**HTTP Code=200**) виглядатиме наступним чином:

```
{
    "status": "OK",
    "details": {
        "database": "connected"
    }
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                                                                 | Обов’язковість |
|:------------------------:|----------------------|-----------|------------------------------------------------------------------------------------|:--------------:|
|            1             | 	status              | 	String    | Повідомлення про статус сервісу                                                                        |      	Так      |
|            1             | details                 |Array    | Масив даних                                                                        |      Так       |
|            2             | database                  | String     | Повідомлення про стан підключення до СКДБ                                              |      Так       |


**Тіло відповіді** у разі неуспішної перевірки працездатності сервісу (**HTTP Code=500 - Internal Server Error**) виглядатиме наступним чином:

```
{
    "status": "fail",
    "details": {
        "database": "disconnected",
        "error": "connect ECONNREFUSED 192.168.99.4:3306"
    }
}
```

де:

| Рівень <br/> вкладеності | Назва <br/>параметру | Тип даних | Значення параметру                                                                 | Обов’язковість |
|:------------------------:|----------------------|-----------|------------------------------------------------------------------------------------|:--------------:|
|            1             | 	status              | 	String    | Повідомлення про статус сервісу                                                                        |      	Так      |
|            1             | details                 |Array    | Масив даних                                                                        |      Так       |
|            2             | database                  | String     | Повідомлення про стан підключення до СКДБ                                              |      Так       |
|            2             | error                  | String     | Опис помилки                                              |      Так       |

##
Матеріали створено за підтримки проєкту міжнародної технічної допомоги «Підтримка ЄС цифрової трансформації України (DT4UA)».
